var covid19Data,mapMetaData={fo:"FO","faroe islands":"FO",um:"UM","united states minor outlying islands":"UM",us:"US","united states of america":"US",jp:"JP",japan:"JP",sc:"SC",seychelles:"SC",in:"IN",india:"IN",fr:"FR",france:"FR",fm:"FM","federated states of micronesia":"FM",cn:"CN",china:"CN",pt:"PT",portugal:"PT",sw:"SW","serranilla bank":"SW",sh:"SH","scarborough reef":"SH",br:"BR",brazil:"BR",ki:"KI",kiribati:"KI",ph:"PH",philippines:"PH",mx:"MX",mexico:"MX",es:"ES",spain:"ES",bu:"BU","bajo nuevo bank (petrel is.)":"BU",mv:"MV",maldives:"MV",sp:"SP","spratly islands":"SP",gb:"GB","united kingdom":"GB",gr:"GR",greece:"GR",as:"AS","american samoa":"AS",dk:"DK",denmark:"DK",gl:"GL",greenland:"GL",gu:"GU",guam:"GU",mp:"MP","northern mariana islands":"MP",pr:"PR","puerto rico":"PR",vi:"VI","united states virgin islands":"VI",ca:"CA",canada:"CA",st:"ST","sao tome and principe":"ST",cv:"CV","cape verde":"CV","cabo verde":"CV",dm:"DM",dominica:"DM",nl:"NL",netherlands:"NL",jm:"JM",jamaica:"JM",ws:"WS",samoa:"WS",om:"OM",oman:"OM",vc:"VC","saint vincent and the grenadines":"VC",tr:"TR",turkey:"TR",bd:"BD",bangladesh:"BD",lc:"LC","saint lucia":"LC",nr:"NR",nauru:"NR",no:"NO",norway:"NO",kn:"KN","saint kitts and nevis":"KN",bh:"BH",bahrain:"BH",to:"TO",tonga:"TO",fi:"FI",finland:"FI",id:"ID",indonesia:"ID",mu:"MU",mauritius:"MU",se:"SE",sweden:"SE",tt:"TT","trinidad and tobago":"TT",my:"MY",malaysia:"MY",pa:"PA",panama:"PA",pw:"PW",palau:"PW",tv:"TV",tuvalu:"TV",mh:"MH","marshall islands":"MH",cl:"CL",chile:"CL",th:"TH",thailand:"TH",gd:"GD",grenada:"GD",ee:"EE",estonia:"EE",ag:"AG","antigua and barbuda":"AG",tw:"TW",taiwan:"TW","taiwan*":"TW",bb:"BB",barbados:"BB",it:"IT",italy:"IT",mt:"MT",malta:"MT",vu:"VU",vanuatu:"VU",sg:"SG",singapore:"SG",cy:"CY",cyprus:"CY",lk:"LK","sri lanka":"LK",km:"KM",comoros:"KM",fj:"FJ",fiji:"FJ",ru:"RU",russia:"RU",va:"VA",vatican:"VA",sm:"SM","san marino":"SM",kz:"KZ",kazakhstan:"KZ",az:"AZ",azerbaijan:"AZ",tj:"TJ",tajikistan:"TJ",ls:"LS",lesotho:"LS",uz:"UZ",uzbekistan:"UZ",ma:"MA",morocco:"MA",co:"CO",colombia:"CO",tl:"TL","east timor":"TL","timor-leste":"TL",tz:"TZ","united republic of tanzania":"TZ",tanzania:"TZ",ar:"AR",argentina:"AR",sa:"SA","saudi arabia":"SA",pk:"PK",pakistan:"PK",ye:"YE",yemen:"YE",ae:"AE","united arab emirates":"AE",ke:"KE",kenya:"KE",pe:"PE",peru:"PE",do:"DO","dominican republic":"DO",ht:"HT",haiti:"HT",pg:"PG","papua new guinea":"PG",ao:"AO",angola:"AO",kh:"KH",cambodia:"KH",vn:"VN",vietnam:"VN",mz:"MZ",mozambique:"MZ",cr:"CR","costa rica":"CR",bj:"BJ",benin:"BJ",ng:"NG",nigeria:"NG",ir:"IR",iran:"IR",sv:"SV","el salvador":"SV",sl:"SL","sierra leone":"SL",gw:"GW","guinea bissau":"GW","guinea-bissau":"GW",hr:"HR",croatia:"HR",bz:"BZ",belize:"BZ",za:"ZA","south africa":"ZA",cf:"CF","central african republic":"CF",sd:"SD",sudan:"SD",cd:"CD","democratic republic of the congo":"CD","congo (kinshasa)":"CD",kw:"KW",kuwait:"KW",de:"DE",germany:"DE",be:"BE",belgium:"BE",ie:"IE",ireland:"IE",kp:"KP","north korea":"KP",kr:"KR","south korea":"KR","korea, south":"KR",gy:"GY",guyana:"GY",hn:"HN",honduras:"HN",mm:"MM",myanmar:"MM",ga:"GA",gabon:"GA",gq:"GQ","equatorial guinea":"GQ",ni:"NI",nicaragua:"NI",lv:"LV",latvia:"LV",ug:"UG",uganda:"UG",mw:"MW",malawi:"MW",am:"AM",armenia:"AM",sx:"SX",somaliland:"SX",tm:"TM",turkmenistan:"TM",zm:"ZM",zambia:"ZM",nc:"NC","northern cyprus":"NC",mr:"MR",mauritania:"MR",dz:"DZ",algeria:"DZ",lt:"LT",lithuania:"LT",et:"ET",ethiopia:"ET",er:"ER",eritrea:"ER",gh:"GH",ghana:"GH",si:"SI",slovenia:"SI",gt:"GT",guatemala:"GT",ba:"BA","bosnia and herzegovina":"BA",jo:"JO",jordan:"JO",sy:"SY",syria:"SY",mc:"MC",monaco:"MC",al:"AL",albania:"AL",uy:"UY",uruguay:"UY",cnm:"CNM","cyprus no mans area":"CNM",mn:"MN",mongolia:"MN",rw:"RW",rwanda:"RW",so:"SO",somalia:"SO",bo:"BO",bolivia:"BO",cm:"CM",cameroon:"CM",cg:"CG","republic of congo":"CG","congo (brazzaville)":"CG",eh:"EH","western sahara":"EH",rs:"RS","republic of serbia":"RS",serbia:"RS",me:"ME",montenegro:"ME",tg:"TG",togo:"TG",la:"LA",laos:"LA",af:"AF",afghanistan:"AF",ua:"UA",ukraine:"UA",sk:"SK",slovakia:"SK",jk:"JK","siachen glacier":"JK",bg:"BG",bulgaria:"BG",qa:"QA",qatar:"QA",li:"LI",liechtenstein:"LI",at:"AT",austria:"AT",sz:"SZ",swaziland:"SZ",hu:"HU",hungary:"HU",ro:"RO",romania:"RO",ne:"NE",niger:"NE",lu:"LU",luxembourg:"LU",ad:"AD",andorra:"AD",ci:"CI","ivory coast":"CI",lr:"LR",liberia:"LR",bn:"BN",brunei:"BN",iq:"IQ",iraq:"IQ",ge:"GE",georgia:"GE",gm:"GM",gambia:"GM",ch:"CH",switzerland:"CH",td:"TD",chad:"TD",kv:"KV",kosovo:"KV",lb:"LB",lebanon:"LB",dj:"DJ",djibouti:"DJ",bi:"BI",burundi:"BI",sr:"SR",suriname:"SR",il:"IL",israel:"IL",ml:"ML",mali:"ML",sn:"SN",senegal:"SN",gn:"GN",guinea:"GN",zw:"ZW",zimbabwe:"ZW",pl:"PL",poland:"PL",mk:"MK",macedonia:"MK","north macedonia":"MK",py:"PY",paraguay:"PY",by:"BY",belarus:"BY",cz:"CZ","czech republic":"CZ",czechia:"CZ",bf:"BF","burkina faso":"BF",na:"NA",namibia:"NA",ly:"LY",libya:"LY",tn:"TN",tunisia:"TN",bt:"BT",bhutan:"BT",md:"MD",moldova:"MD",ss:"SS","south sudan":"SS",bw:"BW",botswana:"BW",bs:"BS","the bahamas":"BS",bahamas:"BS",nz:"NZ","new zealand":"NZ",cu:"CU",cuba:"CU",ec:"EC",ecuador:"EC",au:"AU",australia:"AU",ve:"VE",venezuela:"VE",sb:"SB","solomon islands":"SB",mg:"MG",madagascar:"MG",is:"IS",iceland:"IS",eg:"EG",egypt:"EG",kg:"KG",kyrgyzstan:"KG",np:"NP",nepal:"NP"},mapBackTrack={US:"United States of America"},consolidatedObj={confirmed:0,deaths:0,recovered:0};const getDataFromServer=async a=>fetch(a).then(a=>a.json()),parseMapData=a=>{let b,c=[];for(let d in a)b=mapMetaData[d.toLowerCase()]||"",c.push({"hc-key":b.toLowerCase(),value:a[d][a[d].length-1].confirmed,confirmed:a[d][a[d].length-1].confirmed,deaths:a[d][a[d].length-1].deaths,recovered:a[d][a[d].length-1].recovered,drilldown:b.toLowerCase(),countryName:d});return c},parseChartData=(a,b)=>{let c=[];return b.forEach(b=>{let d={name:"",data:[]};d.name=b,a[b].forEach(a=>{d.data.push([+new Date(a.date),a.confirmed])}),c.push(d)}),{title:{text:"Spread velocity in different countries"},series:c}},parseTopFiveData=(a,b=5)=>{let c=[],d=[{name:"Confirmed",color:"rgb(0, 82, 180)",pointPlacement:-.4,data:[]},{name:"Recovered",color:"rgb(255, 217, 68)",pointPlacement:-.2,data:[]},{name:"Deaths",color:"rgb(215, 0, 38)",data:[]}],e=[],f=[];for(var g in a){var h=a[g][a[g].length-1];c.push([g,h.confirmed,h.deaths,h.recovered])}if(c.sort((a,b)=>(consolidatedObj.confirmed+=a[1],consolidatedObj.deaths+=a[2],consolidatedObj.recovered+=a[3],a[1]>b[1]?-1:1)),b instanceof Array)for(var j=0;j<b.length;j++){let c=a[b[j]];c=c[c.length-1],f.push({country:b[j],confirmed:c.confirmed,recovered:c.recovered,deaths:c.deaths})}else for(var j=0;j<b;j++){let a=c[j];f.push({country:a[0],confirmed:a[1],recovered:a[3],deaths:a[2]})}return e=[],d[0].data=[],d[1].data=[],d[2].data=[],f.sort((c,a)=>c.confirmed<a.confirmed?1:-1),f.forEach(a=>{console.log(a.country,a.confirmed),e.push(a.country),d[0].data.push(a.confirmed),d[1].data.push(a.recovered),d[2].data.push(a.deaths)}),{chart:{height:$(".chart-main-container").height()-10,type:"column"},title:{text:"Confirmed vs Death vs Recovered"},plotOptions:{series:{grouping:!1,borderWidth:0}},series:d,xAxis:{categories:e}}},createSelectBox=(a,b,c)=>{let d=[];for(let e in a)d.push({name:e,value:e,checked:0<=c?.indexOf(e)});$("#select-country").append($(`<select id=${b} multiple="multiple" ></select>`)),$(`#${b}`).multiselect({columns:3,search:!0,texts:{placeholder:"Select Country",search:"Search Country"},onOptionClick:(a,b)=>{console.log("called...",$(a).val(),b),renderChart(parseTopFiveData(covid19Data,$(a).val()),"chart-container2"),renderStockChart(parseChartData(covid19Data,$(a).val()),"chart-container1")}}),$(`#${b}`).multiselect("loadOptions",d)};async function render(){covid19Data=await getDataFromServer("https://pomber.github.io/covid19/timeseries.json"),$(".dropdown").show(),renderMap(parseMapData(covid19Data));var a=parseTopFiveData(covid19Data);renderChart(a,"chart-container2"),createSelectBox(covid19Data,"country-1",a.xAxis.categories),renderStockChart(parseChartData(covid19Data,a.xAxis.categories),"chart-container1"),renderImpactChart(consolidatedObj,"chart-container3","Worldwide",410,190)}function renderImpactChart(a,b,c,d,e){let f=a;renderChart({chart:{height:e,width:d,type:"column"},title:{text:`Total Impact ${c}`},legend:{enabled:!1},series:[{name:"",data:[{color:"rgb(0, 82, 180)",y:f.confirmed},{color:"rgb(255, 217, 68)",y:f.recovered},{color:"rgb(215, 0, 38)",y:f.deaths}]}],xAxis:{categories:["Confirmed","Recovered","Deaths"]}},b)}function renderMap(a){console.log($(window).height()-50),Highcharts.mapChart("map-container",{chart:{height:$(window).height()-120,map:"custom/world",events:{drilldown:function(a){if(!a.seriesOptions){var b=this,c=a.point.countryName,d=Highcharts.mapDataIndex.Countries[mapBackTrack[c]||c];if(!d)return void console.log(`Unable to load ${c}!`);d=d.replace(/\.js/,"");var e=setTimeout(function(){Highcharts.maps[d]||(b.showLoading("<i class=\"icon-frown\"></i> Failed loading "+a.point.name),e=setTimeout(function(){b.hideLoading()},1e3))},3e3);Highcharts.charts[0]&&Highcharts.charts[0].showLoading("<i class=\"fa fa-spinner fa-spin fa-2x\"></i>"),$.getScript("https://code.highcharts.com/mapdata/"+d+".js",function(){data=Highcharts.geojson(Highcharts.maps[d]),$.each(data,function(){this.value=a.point.value}),renderImpactChart(covid19Data[c][covid19Data[c].length-1],"chart-container3",a.point.name,410,190),b.hideLoading(),clearTimeout(e),b.addSeriesAsDrilldown(a.point,{name:" ",data:data,tooltip:{pointFormat:`
                            <b>${a.point.name}</b> <br/>
                            Confirmed: <b>{point.value} </b><br/>
                            Deaths: <b>${a.point.deaths} </b><br/>
                            Recovered: <b>${a.point.recovered} </b><br/>
                          `},dataLabels:{enabled:!1,formatter:function(){return this.point.properties&&this.point.properties["hc-a2"]||this.point.name}}})})}},drillup:function(){renderImpactChart(consolidatedObj,"chart-container3","Worldwide",410,190),this.setTitle(null,{text:""})}}},mapNavigation:{enabled:!0,enableMouseWheelZoom:!1,buttonOptions:{verticalAlign:"bottom"},enableDoubleClickZoomTo:!0},title:{text:""},subtitle:{text:""},colorAxis:{min:1,type:"logarithmic",minColor:"#d8dde6",maxColor:"#113880",_stops:[[0,"#0e46a1"],[.67,"#5c82bf"],[1,"#abbdd9"]]},tooltip:{pointFormat:`
        <b>{point.name}</b> <br/>
        Confirmed: <b>{point.value} </b><br/>
        Deaths: <b>{point.deaths} </b><br/>
        Recovered: <b>{point.recovered} </b><br/>
      `},series:[{data:a,name:" ",states:{hover:{color:"#BADA55"}},dataLabels:{enabled:!1,formatter:function(){return this.point.properties&&this.point.properties["hc-a2"]||this.point.name}}}],drilldown:{activeDataLabelStyle:{color:"#FFFFFF",textDecoration:"none",textOutline:"1px #000000"},drillUpButton:{relativeTo:"spacingBox",position:{x:0,y:60}}}})}function renderChart(a,b){Highcharts.chart(b,Object.assign({chart:{height:$(".chart-main-container").height()-10},title:{text:""},subtitle:{text:""},yAxis:{title:{text:"Number of Cases"}},xAxis:{accessibility:{rangeDescription:"Time"}},legend:{layout:"vertical",align:"right",verticalAlign:"middle"},plotOptions:{series:{label:{connectorAllowed:!1}}},series:a,responsive:{rules:[{condition:{maxWidth:500},chartOptions:{legend:{layout:"horizontal",align:"center",verticalAlign:"bottom"}}}]}},a))}function renderStockChart(a,b){Highstock.stockChart(b,Object.assign({chart:{height:$(".chart-main-container").height()-10},rangeSelector:{selected:4},yAxis:{labels:{formatter:function(){return(0<this.value?" + ":"")+this.value}},plotLines:[{value:0,width:2,color:"silver"}]},scrollbar:{enabled:!1},navigator:{enabled:!0},legend:{enabled:!1},plotOptions:{series:{compare:"percent",showInNavigator:!0}},tooltip:{valueDecimals:2,split:!0},series:[]},a))}render();